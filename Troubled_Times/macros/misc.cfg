#! when first player dies (current) game is lost or only if all 3 (message seem to implicate that...)?
#define LEADER_ALIVE_CHECK
    [event]
        name=die
        first_time_only=no
        [if]
            [not]
                [have_unit]
                    canrecruit=yes
                    side=1
                [/have_unit]
                [have_unit]
                    canrecruit=yes
                    side=2
                [/have_unit]
                [have_unit]
                    canrecruit=yes
                    side=3
                [/have_unit]
            [/not]
            [then]
                [message]
                    speaker=narrator
                    message=_ "Our great warriors weren't so great this time. You lost!"
                    image=wesnoth-icon.png
                [/message]
                [endlevel]
                    result=defeat
                [/endlevel]
            [/then]
        [/if]
    [/event]
#enddef

#define SIDE_DATA SIDE NAME
    side={SIDE}
    controller=human
    unit_description={NAME}
    name={NAME}
    team_name=Elves
    id={NAME}
    save_id={NAME}_{SIDE}
    type={NAME}
    canrecruit=yes
    persistent=yes
    team_lock=yes
    gold_lock=yes
    income_lock=yes
    colour_lock=yes
    unrenable=yes
    gold=25
    income=-2
    village_gold=2
    share_view=yes
    share_map=yes
#enddef

#define RING_SPEED X Y
    [item]
        x={X}
        y={Y}
        image=items/ring-silver.png
        halo=halo/holy/saurian-magic-halo-6.png
    [/item]

    [event]
        name=moveto
        first_time_only=yes
        [filter]
            side=1,2,3
            x={X}
            y={Y}
        [/filter]
        [removeitem]
            x={X}
            y={Y}
        [/removeitem]
        [object]
            [filter]
                side=1
                canrecruit=yes
            [/filter]
            silent=yes
            [effect]
                apply_to=movement
                increase=1
            [/effect]
        [/object]
        [object]
            [filter]
                side=2
                canrecruit=yes
            [/filter]
            silent=yes
            [effect]
                apply_to=movement
                increase=1
            [/effect]
        [/object]
        [object]
            [filter]
                side=3
                canrecruit=yes
            [/filter]
            silent=yes
            [effect]
                apply_to=movement
                increase=1
            [/effect]
        [/object]
        [message]
            speaker=unit
            message= _ "I feel that every elf leader is suddenly moving a bit faster."
        [/message]
    [/event]
#enddef

#define EXPERIENCE_BONUS TURNS SCE
    [event] #! could that cause OOS?
        name=victory

        [store_unit]
            [filter]
                side=1
                [or]
                    side=2
                [/or]
                [or]
                    side=3
                [/or]
                x,y=1-999,1-999
            [/filter]
            variable=giveex
        [/store_unit]

        {VARIABLE turns_left "$({TURNS}-$turn_number)"}
        {VARIABLE exp_bonus "$($turns_left*{SCE})"}

        {FOREACH giveex X}
            {IF_VAR giveex[$X].canrecruit not_equals yes (
                [then] #! TODO look for balancing
                    {VARIABLE_OP $exp_bonus sub $giveex.length}
                    {VARIABLE_OP $exp_bonus divide $giveex[$X].level}
                [/then]
                [else]
                    {VARIABLE_OP $exp_bonus sub $giveex.length}
                [/else]
            )}
            {IF_VAR $exp_bonus greater_than 0 (
                [then]
                    {VARIABLE_OP giveex[$X].experience add $exp_bonus}
                    [unstore_unit]
                        variable=giveex[$X]
                        find_vacant=no
                        advance=true
                    [/unstore_unit]
                [/then]
            )}
        {NEXT X}
        {CLEAR_VARIABLE giveex}
        {CLEAR_VARIABLE turns_left}
        {CLEAR_VARIABLE exp_bonus}
    [/event]
#enddef

#define RECALL_LOYALS
    [store_unit]
        variable=loyals
        [filter]
            [filter_wml]
                upkeep="loyal"
            [/filter_wml]
            [not]
                canrecruit=yes
                [or]
                    level=0
                [/or]
            [/not]
            x,y=recall,recall
        [/filter]
    [/store_unit]

    {FOREACH loyals L}
        [recall]
            id=$loyals[$L].id
            placement=leader
        [/recall]
    {NEXT L}
    {CLEAR_VARIABLE loyals}
#enddef

#define LEADERS_GOLD
    [event]
        name=die
        first_time_only=no

        [filter]
            canrecruit=yes
            is_enemy=yes
        [/filter]

        [gold]
            side=1
            amount=25
        [/gold]

        [gold]
            side=2
            amount=25
        [/gold]

        [gold]
            side=3
            amount=25
        [/gold]
    [/event]
#enddef
